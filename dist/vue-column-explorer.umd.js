(function(y,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("pinia"),require("lucide-vue-next")):typeof define=="function"&&define.amd?define(["exports","vue","pinia","lucide-vue-next"],e):(y=typeof globalThis<"u"?globalThis:y||self,e(y.VueColumnExplorer={},y.Vue,y.Pinia,y.LucideVueNext))})(this,function(y,e,A,d){"use strict";const N=A.defineStore("explorer",{state:()=>({columns:new Map,activeColumnIndex:-1,breadcrumb:[],globalFilters:{},config:{appearance:{columnWidth:300,maxVisibleColumns:4,animationDuration:200,theme:"light"},behavior:{clickBehavior:"single",selectionPersistence:!1,autoLoadNextPage:!0,scrollBehavior:"smooth"},performance:{itemsPerPage:50,virtualScrollThreshold:100,maxConcurrentRequests:2,requestTimeout:1e4}}}),getters:{visibleColumns(){const t=[];for(let c=0;c<=this.activeColumnIndex;c++){const o=this.columns.get(c);o&&t.push(o)}return t},currentSelection(){const t=this.columns.get(this.activeColumnIndex);return(t==null?void 0:t.selectedIds)||new Set},canNavigateForward(){const t=this.columns.get(this.activeColumnIndex);return t?t.selectedIds.size>0:!1},getContext(){var o;const t=[];for(let n=0;n<=this.activeColumnIndex;n++){const l=this.columns.get(n);if(l){const a=Array.from(l.selectedIds)[0],i=a&&l.items.find(k=>k.id===a)||null;t.push({columnId:l.config.id,selectedItem:i,selectedIds:l.selectedIds})}}const c=t[t.length-2];return{parentId:((o=c==null?void 0:c.selectedItem)==null?void 0:o.id)||null,parentItem:(c==null?void 0:c.selectedItem)||null,breadcrumb:this.breadcrumb,globalFilters:this.globalFilters,columnChain:t,getParentData(n){return t[t.length-1-n]},getColumnData(n){return t.find(l=>l.columnId===n)}}}},actions:{setConfig(t){this.config={appearance:{...this.config.appearance,...t.appearance},behavior:{...this.config.behavior,...t.behavior},performance:{...this.config.performance,...t.performance}}},async openColumn(t,c){const o=c??this.activeColumnIndex+1;for(let l=this.columns.size-1;l>o;l--)this.columns.delete(l);const n={config:t,items:[],selectedIds:new Set,page:0,hasMore:!0,isLoading:!1,error:null,filters:{}};this.columns.set(o,n),this.activeColumnIndex=o,o===0&&(this.breadcrumb=[{columnId:t.id,columnName:t.name}]),await this.loadColumnData(o)},async loadColumnData(t,c=0){const o=this.columns.get(t);if(o){o.isLoading=!0,o.error=null;try{const n=this.getContext,l=await o.config.dataProvider.fetch({parentId:n.parentId,page:c,filters:{...this.globalFilters,...o.filters},context:n});c===0?o.items=l.items:o.items.push(...l.items),o.hasMore=l.hasMore,o.page=c}catch(n){o.error=n,console.error("Error loading column data:",n)}finally{o.isLoading=!1}}},async loadNextPage(t){const c=this.columns.get(t);!c||!c.hasMore||c.isLoading||await this.loadColumnData(t,c.page+1)},async refreshColumn(t){const c=this.columns.get(t);c&&(c.selectedIds.clear(),await this.loadColumnData(t,0))},selectItem(t,c,o=!1){var l;const n=this.columns.get(t);!n||!((l=n.config.selection)!=null&&l.enabled)||(o&&n.config.selection.multiple?n.selectedIds.has(c)?n.selectedIds.delete(c):n.selectedIds.add(c):(n.selectedIds.clear(),n.selectedIds.add(c)))},clearSelection(t){const c=this.columns.get(t);c&&c.selectedIds.clear()},async navigateToItem(t,c){var a,i,k;const o=this.columns.get(c);if(!o||!o.config.itemClick)return;const n=this.getContext,l=await((i=(a=o.config.itemClick).handler)==null?void 0:i.call(a,t,n));if(l!=null&&l.column)this.breadcrumb=this.breadcrumb.slice(0,c+1),await this.openColumn(l.column,c+1),this.breadcrumb.push({columnId:l.column.id,columnName:t.name,itemId:t.id,itemName:t.name});else if(l!=null&&l.action){const p=(k=o.config.actions)==null?void 0:k.find(_=>_.key===l.action);p&&await this.executeAction(c,p.key)}else l!=null&&l.custom&&l.custom()},async executeAction(t,c){var a;const o=this.columns.get(t);if(!o)return;const n=(a=o.config.actions)==null?void 0:a.find(i=>i.key===c);if(!n)return;const l=Array.from(o.selectedIds);if(l.length!==0)try{const i=this.getContext;await n.handler(l,i),await this.refreshColumn(t)}catch(i){console.error("Error executing action:",i)}},navigateToBreadcrumb(t){for(let c=this.columns.size-1;c>t;c--)this.columns.delete(c);this.activeColumnIndex=t,this.breadcrumb=this.breadcrumb.slice(0,t+1)},setFilter(t,c,o){const n=this.columns.get(t);n&&(o==null||o===""?delete n.filters[c]:n.filters[c]=o,this.loadColumnData(t,0))},setGlobalFilter(t,c){c==null||c===""?delete this.globalFilters[t]:this.globalFilters[t]=c,this.visibleColumns.forEach((o,n)=>{this.loadColumnData(n,0)})}}}),L={class:"explorer-breadcrumb"},V=["onClick"],z=e.defineComponent({__name:"ExplorerBreadcrumb",props:{breadcrumb:{}},emits:["navigate"],setup(t,{emit:c}){const o=c,n=l=>{o("navigate",l)};return(l,a)=>(e.openBlock(),e.createElementBlock("div",L,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.breadcrumb,(i,k)=>(e.openBlock(),e.createElementBlock("div",{key:k,class:"breadcrumb-item"},[e.createElementVNode("button",{class:e.normalizeClass(["breadcrumb-item__button",{"breadcrumb-item__button--active":k===t.breadcrumb.length-1}]),onClick:p=>n(k)},e.toDisplayString(i.itemName||i.columnName),11,V),k<t.breadcrumb.length-1?(e.openBlock(),e.createBlock(e.unref(d.ChevronRight),{key:0,size:16,class:"breadcrumb-separator"})):e.createCommentVNode("",!0)]))),128))]))}}),x=(t,c)=>{const o=t.__vccOpts||t;for(const[n,l]of c)o[n]=l;return o},T=x(z,[["__scopeId","data-v-27ca8931"]]),O={key:0,class:"explorer-item__checkbox"},P=["checked"],R={class:"explorer-item__content"},q={key:0,class:"explorer-item__icon"},j={class:"explorer-item__details"},H={class:"explorer-item__name"},U={key:0,class:"explorer-item__metadata"},G={key:1,class:"explorer-item__chevron"},W={key:0,class:"item-count"},X=x(e.defineComponent({__name:"ExplorerItem",props:{item:{},selected:{type:Boolean,default:!1},selectable:{type:Boolean,default:!1},clickable:{type:Boolean,default:!0},showIcon:{type:Boolean,default:!0},showMetadata:{type:Boolean,default:!0}},emits:["click","dblclick","contextmenu","select"],setup(t,{emit:c}){const o=t,n=c,l=e.computed(()=>o.item.icon?{"lucide:user":d.User,"lucide:folder":d.Folder,"lucide:file":d.File,"lucide:book":d.Book,"lucide:file-text":d.FileText,"lucide:clipboard":d.Clipboard}[o.item.icon]||d.File:o.item.type==="folder"?d.Folder:d.File),a=h=>{o.clickable&&n("click",o.item,h)},i=h=>{n("dblclick",o.item,h)},k=h=>{n("contextmenu",o.item,h)},p=h=>{n("select",o.item,!0)},_=h=>{const B=Object.entries(h);if(B.length===0)return"";const S=B[0];return String(S[1])};return(h,B)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["explorer-item",{"explorer-item--selected":t.selected,"explorer-item--clickable":t.clickable}]),onClick:a,onDblclick:i,onContextmenu:e.withModifiers(k,["prevent"])},[t.selectable?(e.openBlock(),e.createElementBlock("div",O,[e.createElementVNode("input",{type:"checkbox",checked:t.selected,onClick:e.withModifiers(p,["stop"])},null,8,P)])):e.createCommentVNode("",!0),e.createElementVNode("div",R,[t.showIcon?(e.openBlock(),e.createElementBlock("div",q,[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(l.value),{size:20}))])):e.createCommentVNode("",!0),e.createElementVNode("div",j,[e.createElementVNode("div",H,e.toDisplayString(t.item.name),1),t.showMetadata&&t.item.metadata?(e.openBlock(),e.createElementBlock("div",U,e.toDisplayString(_(t.item.metadata)),1)):e.createCommentVNode("",!0)])]),t.item.count!==void 0||t.item.hasChildren?(e.openBlock(),e.createElementBlock("div",G,[t.item.count!==void 0?(e.openBlock(),e.createElementBlock("span",W,e.toDisplayString(t.item.count),1)):e.createCommentVNode("",!0),e.createVNode(e.unref(d.ChevronRight),{size:16})])):e.createCommentVNode("",!0)],34))}}),[["__scopeId","data-v-b2b4e9d4"]]),Y={class:"explorer-column__header"},J={class:"explorer-column__title"},Q={class:"explorer-column__actions"},Z={key:0,class:"explorer-column__filters"},K={class:"filter-item__label"},v=["placeholder","value","onInput"],ee=["placeholder","value","onInput"],te=["value","onChange"],ne=["value"],oe={key:0,class:"explorer-column__loading"},le={key:1,class:"explorer-column__error"},ce={key:2,class:"explorer-column__empty"},se={key:3,class:"explorer-column__items"},ae={key:0,class:"explorer-column__loading-more"},ie={key:1,class:"explorer-column__footer"},re={class:"explorer-column__selection-info"},me={class:"explorer-column__quick-actions"},de=["onClick"],he=x(e.defineComponent({__name:"ExplorerColumn",props:{columnState:{},index:{},isActive:{type:Boolean}},emits:["item-click","item-select","context-menu","refresh","load-more","action","filter-change"],setup(t,{emit:c}){const o=t,n=c,l=e.ref(null),a=e.ref(!1),i=e.computed(()=>o.columnState.config.filters&&o.columnState.config.filters.length>0),k=e.computed(()=>o.columnState.selectedIds.size>0),p=e.computed(()=>{var m;return((m=o.columnState.config.view)==null?void 0:m.loadingRows)||10}),_=e.computed(()=>{var m;return((m=o.columnState.config.view)==null?void 0:m.emptyMessage)||"No items found"}),h=e.computed(()=>{if(!o.columnState.config.actions)return[];const m=o.columnState.items.filter(s=>o.columnState.selectedIds.has(s.id)),u=m.length;return o.columnState.config.actions.filter(s=>u===1&&s.showOnSingleSelect===!1||u>1&&s.showOnMultipleSelect===!1||u===1&&s.showOnMultipleSelect===!0&&s.showOnSingleSelect===!1||u>1&&s.showOnSingleSelect===!0&&s.showOnMultipleSelect===!1?!1:s.visible?s.visible(m):!0)}),B=()=>{a.value=!a.value},S=(m,u)=>{n("item-click",m,o.index)},w=(m,u)=>{n("item-select",m,o.index,u)},M=(m,u)=>{n("context-menu",m,o.index,u)},r=()=>{n("refresh",o.index)},f=()=>{if(!l.value)return;const{scrollTop:m,scrollHeight:u,clientHeight:s}=l.value;m+s>=u-100&&o.columnState.hasMore&&!o.columnState.isLoading&&n("load-more",o.index)},g=m=>{n("action",m,o.index)},C=(m,u)=>{n("filter-change",m,u,o.index)},be=m=>({"lucide:trash":d.Trash,"lucide:download":d.Download,"lucide:edit":d.Edit,"lucide:mail":d.Mail})[m]||null;return(m,u)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["explorer-column",{"explorer-column--active":t.isActive}])},[e.createElementVNode("div",Y,[e.createElementVNode("h3",J,e.toDisplayString(t.columnState.config.name),1),e.createElementVNode("div",Q,[i.value?(e.openBlock(),e.createElementBlock("button",{key:0,class:e.normalizeClass(["explorer-column__filter-btn",{active:a.value}]),onClick:B},[e.createVNode(e.unref(d.Filter),{size:16})],2)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"explorer-column__refresh-btn",onClick:r},[e.createVNode(e.unref(d.RefreshCw),{size:16})])])]),a.value&&i.value?(e.openBlock(),e.createElementBlock("div",Z,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.columnState.config.filters,s=>(e.openBlock(),e.createElementBlock("div",{key:s.key,class:"filter-item"},[e.createElementVNode("label",K,e.toDisplayString(s.label),1),s.type==="search"?(e.openBlock(),e.createElementBlock("input",{key:0,type:"text",class:"filter-item__input",placeholder:`Search ${s.label.toLowerCase()}...`,value:t.columnState.filters[s.key]||"",onInput:b=>C(s.key,b.target.value)},null,40,v)):s.type==="number"?(e.openBlock(),e.createElementBlock("input",{key:1,type:"number",class:"filter-item__input",placeholder:s.label,value:t.columnState.filters[s.key]||"",onInput:b=>C(s.key,b.target.value)},null,40,ee)):s.type==="select"?(e.openBlock(),e.createElementBlock("select",{key:2,class:"filter-item__select",value:t.columnState.filters[s.key]||"",onChange:b=>C(s.key,b.target.value)},[u[0]||(u[0]=e.createElementVNode("option",{value:""},"All",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.options,b=>(e.openBlock(),e.createElementBlock("option",{key:b.value,value:b.value},e.toDisplayString(b.label),9,ne))),128))],40,te)):e.createCommentVNode("",!0)]))),128))])):e.createCommentVNode("",!0),e.createElementVNode("div",{ref_key:"scrollContainer",ref:l,class:"explorer-column__content",onScroll:f},[t.columnState.isLoading&&t.columnState.items.length===0?(e.openBlock(),e.createElementBlock("div",oe,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(p.value,s=>(e.openBlock(),e.createElementBlock("div",{key:s,class:"skeleton-item"}))),128))])):t.columnState.error?(e.openBlock(),e.createElementBlock("div",le,[u[1]||(u[1]=e.createElementVNode("p",null,"Error loading data",-1)),e.createElementVNode("button",{onClick:r},"Retry")])):t.columnState.items.length===0?(e.openBlock(),e.createElementBlock("div",ce,e.toDisplayString(_.value),1)):(e.openBlock(),e.createElementBlock("div",se,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.columnState.items,s=>{var b,$,D;return e.openBlock(),e.createBlock(X,{key:s.id,item:s,selected:t.columnState.selectedIds.has(s.id),selectable:((b=t.columnState.config.selection)==null?void 0:b.multiple)??!1,clickable:!0,"show-icon":(($=t.columnState.config.view)==null?void 0:$.showIcon)??!0,"show-metadata":((D=t.columnState.config.view)==null?void 0:D.showMetadata)??!0,onClick:(E,I)=>S(E),onSelect:(E,I)=>w(E,I),onContextmenu:(E,I)=>M(E,I)},null,8,["item","selected","selectable","show-icon","show-metadata","onClick","onSelect","onContextmenu"])}),128)),t.columnState.isLoading&&t.columnState.items.length>0?(e.openBlock(),e.createElementBlock("div",ae," Loading more... ")):e.createCommentVNode("",!0)]))],544),k.value?(e.openBlock(),e.createElementBlock("div",ie,[e.createElementVNode("div",re,e.toDisplayString(t.columnState.selectedIds.size)+" selected ",1),e.createElementVNode("div",me,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.value,s=>(e.openBlock(),e.createElementBlock("button",{key:s.key,class:e.normalizeClass(["action-btn",`action-btn--${s.color||"default"}`]),onClick:b=>g(s.key)},[s.icon?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(be(s.icon)),{key:0,size:14})):e.createCommentVNode("",!0),e.createTextVNode(" "+e.toDisplayString(s.label),1)],10,de))),128))])])):e.createCommentVNode("",!0)],2))}}),[["__scopeId","data-v-0d17a401"]]),ue=["onClick"],ke=x(e.defineComponent({__name:"ExplorerContextMenu",props:{visible:{type:Boolean},x:{},y:{},actions:{}},emits:["close","action"],setup(t,{emit:c}){const o=t,n=c,l=()=>{n("close")},a=p=>{n("action",p.key),n("close")},i=p=>({"lucide:download":d.Download,"lucide:trash":d.Trash,"lucide:edit":d.Edit,"lucide:eye":d.Eye})[p]||null,k=()=>{o.visible&&n("close")};return e.onMounted(()=>{document.addEventListener("click",k)}),e.onUnmounted(()=>{document.removeEventListener("click",k)}),(p,_)=>(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[t.visible?(e.openBlock(),e.createElementBlock("div",{key:0,class:"context-menu",style:e.normalizeStyle({top:`${t.y}px`,left:`${t.x}px`}),onClick:l},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.actions,h=>(e.openBlock(),e.createElementBlock("div",{key:h.key,class:"context-menu__item",onClick:B=>a(h)},[h.icon?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(i(h.icon)),{key:0,size:16})):e.createCommentVNode("",!0),e.createElementVNode("span",null,e.toDisplayString(h.label),1)],8,ue))),128))],4)):e.createCommentVNode("",!0)]))}}),[["__scopeId","data-v-569d2f59"]]),fe={class:"explorer-container"},pe={class:"explorer-viewport"},F=x(e.defineComponent({__name:"ExplorerContainer",props:{rootColumn:{}},setup(t,{expose:c}){const o=t,n=N(),l=e.reactive({visible:!1,x:0,y:0,actions:[],targetItem:null,targetColumnIndex:-1});o.rootColumn&&n.openColumn(o.rootColumn,0);const a=async(r,f)=>{n.selectItem(f,r.id,!1);const g=n.columns.get(f);g!=null&&g.config.itemClick&&await n.navigateToItem(r,f)},i=(r,f,g)=>{n.selectItem(f,r.id,g)},k=(r,f,g)=>{const C=n.columns.get(f);!(C!=null&&C.config.actions)||C.config.actions.length===0||(C.selectedIds.has(r.id)||n.selectItem(f,r.id,!1),l.visible=!0,l.x=g.clientX,l.y=g.clientY,l.actions=C.config.actions,l.targetItem=r,l.targetColumnIndex=f)},p=()=>{l.visible=!1},_=async r=>{l.targetColumnIndex>=0&&await n.executeAction(l.targetColumnIndex,r)},h=r=>{n.navigateToBreadcrumb(r)},B=async r=>{await n.refreshColumn(r)},S=async r=>{await n.loadNextPage(r)},w=async(r,f)=>{await n.executeAction(f,r)},M=(r,f,g)=>{n.setFilter(g,r,f)};return c({store:n,openColumn:r=>n.openColumn(r),refresh:()=>n.refreshColumn(n.activeColumnIndex)}),(r,f)=>(e.openBlock(),e.createElementBlock("div",fe,[e.unref(n).breadcrumb.length>0?(e.openBlock(),e.createBlock(T,{key:0,breadcrumb:e.unref(n).breadcrumb,onNavigate:h},null,8,["breadcrumb"])):e.createCommentVNode("",!0),e.createElementVNode("div",pe,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(n).visibleColumns,(g,C)=>(e.openBlock(),e.createBlock(he,{key:C,"column-state":g,index:C,"is-active":C===e.unref(n).activeColumnIndex,onItemClick:a,onItemSelect:i,onContextMenu:k,onRefresh:B,onLoadMore:S,onAction:w,onFilterChange:M},null,8,["column-state","index","is-active"]))),128))]),e.createVNode(ke,{visible:l.visible,x:l.x,y:l.y,actions:l.actions,onClose:p,onAction:_},null,8,["visible","x","y","actions"])]))}}),[["__scopeId","data-v-4e9a0e53"]]);function ge(t){var c,o,n;return{id:t.id,name:t.name,dataProvider:{fetch:async l=>{const a=await t.fetchData(l);return{items:Array.isArray(a)?a:[],hasMore:!1}}},selection:{enabled:t.allowMultipleSelection!==void 0||!!(t.singleActions&&t.singleActions.length>0)||!!(t.multipleActions&&t.multipleActions.length>0),multiple:t.allowMultipleSelection!==void 0?t.allowMultipleSelection:!1},filters:(c=t.filters)==null?void 0:c.map(l=>({...l,default:void 0})),actions:[...((o=t.singleActions)==null?void 0:o.map(l=>({key:l.key,label:l.label,icon:l.icon,color:l.color,showOnSingleSelect:!0,showOnMultipleSelect:!1,handler:async(a,i)=>{await l.handler(a)}})))||[],...((n=t.multipleActions)==null?void 0:n.map(l=>({key:l.key,label:l.label,icon:l.icon,color:l.color,showOnSingleSelect:!1,showOnMultipleSelect:!0,handler:async(a,i)=>{await l.handler(a)}})))||[]],itemClick:t.onItemClick?{type:"navigate",handler:async(l,a)=>{const i=t.onItemClick(l,a);return i?{column:i}:{}}}:void 0,view:{showIcon:!0,showMetadata:!0,emptyMessage:`No ${t.name.toLowerCase()} found`}}}const Ce={install(t){t.component("ExplorerContainer",F)}};y.ExplorerContainer=F,y.createColumn=ge,y.default=Ce,y.useExplorerStore=N,Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
