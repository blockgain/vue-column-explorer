(function(b,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("pinia"),require("lucide-vue-next")):typeof define=="function"&&define.amd?define(["exports","vue","pinia","lucide-vue-next"],e):(b=typeof globalThis<"u"?globalThis:b||self,e(b.VueColumnExplorer={},b.Vue,b.Pinia,b.LucideVueNext))})(this,function(b,e,A,d){"use strict";const F=A.defineStore("explorer",{state:()=>({columns:new Map,activeColumnIndex:-1,breadcrumb:[],globalFilters:{},config:{appearance:{columnWidth:300,maxVisibleColumns:4,animationDuration:200,theme:"light"},behavior:{clickBehavior:"single",selectionPersistence:!1,autoLoadNextPage:!0,scrollBehavior:"smooth"},performance:{itemsPerPage:50,virtualScrollThreshold:100,maxConcurrentRequests:2,requestTimeout:1e4}}}),getters:{visibleColumns(){const t=[];for(let c=0;c<=this.activeColumnIndex;c++){const n=this.columns.get(c);n&&t.push(n)}return t},currentSelection(){const t=this.columns.get(this.activeColumnIndex);return(t==null?void 0:t.selectedIds)||new Set},canNavigateForward(){const t=this.columns.get(this.activeColumnIndex);return t?t.selectedIds.size>0:!1},getContext(){var n;const t=[];for(let o=0;o<=this.activeColumnIndex;o++){const l=this.columns.get(o);if(l){const a=Array.from(l.selectedIds)[0],i=a&&l.items.find(k=>k.id===a)||null;t.push({columnId:l.config.id,selectedItem:i,selectedIds:l.selectedIds})}}const c=t[t.length-2];return{parentId:((n=c==null?void 0:c.selectedItem)==null?void 0:n.id)||null,parentItem:(c==null?void 0:c.selectedItem)||null,breadcrumb:this.breadcrumb,globalFilters:this.globalFilters,columnChain:t,getParentData(o){return t[t.length-1-o]},getColumnData(o){return t.find(l=>l.columnId===o)}}}},actions:{setConfig(t){this.config={appearance:{...this.config.appearance,...t.appearance},behavior:{...this.config.behavior,...t.behavior},performance:{...this.config.performance,...t.performance}}},async openColumn(t,c){const n=c??this.activeColumnIndex+1;for(let l=this.columns.size-1;l>n;l--)this.columns.delete(l);const o={config:t,items:[],selectedIds:new Set,page:0,hasMore:!0,isLoading:!1,error:null,filters:{}};this.columns.set(n,o),this.activeColumnIndex=n,n===0&&(this.breadcrumb=[{columnId:t.id,columnName:t.name}]),await this.loadColumnData(n)},async loadColumnData(t,c=0){const n=this.columns.get(t);if(n){n.isLoading=!0,n.error=null,c===0&&(n.items=[]);try{const o=this.getContext,l=await n.config.dataProvider.fetch({parentId:o.parentId,page:c,filters:{...this.globalFilters,...n.filters},context:o});c===0?n.items=l.items:n.items.push(...l.items),n.hasMore=l.hasMore,n.page=c}catch(o){n.error=o,console.error("Error loading column data:",o)}finally{n.isLoading=!1}}},async loadNextPage(t){const c=this.columns.get(t);!c||!c.hasMore||c.isLoading||await this.loadColumnData(t,c.page+1)},async refreshColumn(t){const c=this.columns.get(t);c&&(c.selectedIds.clear(),c.page=0,await this.loadColumnData(t,0))},selectItem(t,c,n=!1){var l;const o=this.columns.get(t);!o||!((l=o.config.selection)!=null&&l.enabled)||(n&&o.config.selection.multiple?o.selectedIds.has(c)?o.selectedIds.delete(c):o.selectedIds.add(c):(o.selectedIds.clear(),o.selectedIds.add(c)))},clearSelection(t){const c=this.columns.get(t);c&&c.selectedIds.clear()},async navigateToItem(t,c){var a,i,k;const n=this.columns.get(c);if(!n||!n.config.itemClick)return;const o=this.getContext,l=await((i=(a=n.config.itemClick).handler)==null?void 0:i.call(a,t,o));if(l!=null&&l.column)this.breadcrumb=this.breadcrumb.slice(0,c+1),await this.openColumn(l.column,c+1),this.breadcrumb.push({columnId:l.column.id,columnName:t.name,itemId:t.id,itemName:t.name});else if(l!=null&&l.action){const p=(k=n.config.actions)==null?void 0:k.find(_=>_.key===l.action);p&&await this.executeAction(c,p.key)}else l!=null&&l.custom&&l.custom()},async executeAction(t,c){var a;const n=this.columns.get(t);if(!n)return;const o=(a=n.config.actions)==null?void 0:a.find(i=>i.key===c);if(!o)return;const l=Array.from(n.selectedIds);if(l.length!==0)try{const i=this.getContext;await o.handler(l,i),await this.refreshColumn(t)}catch(i){console.error("Error executing action:",i)}},navigateToBreadcrumb(t){for(let c=this.columns.size-1;c>t;c--)this.columns.delete(c);this.activeColumnIndex=t,this.breadcrumb=this.breadcrumb.slice(0,t+1)},setFilter(t,c,n){const o=this.columns.get(t);o&&(n==null||n===""?delete o.filters[c]:o.filters[c]=n,this.loadColumnData(t,0))},setGlobalFilter(t,c){c==null||c===""?delete this.globalFilters[t]:this.globalFilters[t]=c,this.visibleColumns.forEach((n,o)=>{this.loadColumnData(o,0)})}}}),V={class:"explorer-breadcrumb"},z=["onClick"],T=e.defineComponent({__name:"ExplorerBreadcrumb",props:{breadcrumb:{}},emits:["navigate"],setup(t,{emit:c}){const n=c,o=l=>{n("navigate",l)};return(l,a)=>(e.openBlock(),e.createElementBlock("div",V,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.breadcrumb,(i,k)=>(e.openBlock(),e.createElementBlock("div",{key:k,class:"breadcrumb-item"},[e.createElementVNode("button",{class:e.normalizeClass(["breadcrumb-item__button",{"breadcrumb-item__button--active":k===t.breadcrumb.length-1}]),onClick:p=>o(k)},e.toDisplayString(i.itemName||i.columnName),11,z),k<t.breadcrumb.length-1?(e.openBlock(),e.createBlock(e.unref(d.ChevronRight),{key:0,size:16,class:"breadcrumb-separator"})):e.createCommentVNode("",!0)]))),128))]))}}),x=(t,c)=>{const n=t.__vccOpts||t;for(const[o,l]of c)n[o]=l;return n},O=x(T,[["__scopeId","data-v-27ca8931"]]),P={key:0,class:"explorer-item__checkbox"},R=["checked"],q={class:"explorer-item__content"},j={key:0,class:"explorer-item__icon"},H={class:"explorer-item__details"},U={class:"explorer-item__name"},G={key:0,class:"explorer-item__metadata"},W={key:1,class:"explorer-item__chevron"},X={key:0,class:"item-count"},Y=x(e.defineComponent({__name:"ExplorerItem",props:{item:{},selected:{type:Boolean,default:!1},selectable:{type:Boolean,default:!1},clickable:{type:Boolean,default:!0},showIcon:{type:Boolean,default:!0},showMetadata:{type:Boolean,default:!0}},emits:["click","dblclick","contextmenu","select"],setup(t,{emit:c}){const n=t,o=c,l=e.computed(()=>n.item.icon?{"lucide:user":d.User,"lucide:folder":d.Folder,"lucide:file":d.File,"lucide:book":d.Book,"lucide:file-text":d.FileText,"lucide:clipboard":d.Clipboard}[n.item.icon]||d.File:n.item.type==="folder"?d.Folder:d.File),a=u=>{n.clickable&&o("click",n.item,u)},i=u=>{o("dblclick",n.item,u)},k=u=>{o("contextmenu",n.item,u)},p=u=>{o("select",n.item,!0)},_=u=>{const B=Object.entries(u);if(B.length===0)return"";const S=B[0];return String(S[1])};return(u,B)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["explorer-item",{"explorer-item--selected":t.selected,"explorer-item--clickable":t.clickable}]),onClick:a,onDblclick:i,onContextmenu:e.withModifiers(k,["prevent"])},[t.selectable?(e.openBlock(),e.createElementBlock("div",P,[e.createElementVNode("input",{type:"checkbox",checked:t.selected,onClick:e.withModifiers(p,["stop"])},null,8,R)])):e.createCommentVNode("",!0),e.createElementVNode("div",q,[t.showIcon?(e.openBlock(),e.createElementBlock("div",j,[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(l.value),{size:20}))])):e.createCommentVNode("",!0),e.createElementVNode("div",H,[e.createElementVNode("div",U,e.toDisplayString(t.item.name),1),t.showMetadata&&t.item.metadata?(e.openBlock(),e.createElementBlock("div",G,e.toDisplayString(_(t.item.metadata)),1)):e.createCommentVNode("",!0)])]),t.item.count!==void 0||t.item.hasChildren?(e.openBlock(),e.createElementBlock("div",W,[t.item.count!==void 0?(e.openBlock(),e.createElementBlock("span",X,e.toDisplayString(t.item.count),1)):e.createCommentVNode("",!0),e.createVNode(e.unref(d.ChevronRight),{size:16})])):e.createCommentVNode("",!0)],34))}}),[["__scopeId","data-v-b2b4e9d4"]]),J={class:"explorer-column__header"},Q={class:"explorer-column__title"},Z={class:"explorer-column__actions"},K={key:0,class:"explorer-column__filters"},v={class:"filter-item__label"},ee=["placeholder","value","onInput"],te=["placeholder","value","onInput"],ne=["value","onChange"],oe=["value"],le={key:0,class:"explorer-column__loading"},ce={key:1,class:"explorer-column__error"},se={key:2,class:"explorer-column__empty"},ae={key:3,class:"explorer-column__items"},ie={key:0,class:"explorer-column__loading-more"},re={key:1,class:"explorer-column__footer"},me={class:"explorer-column__selection-info"},de={class:"explorer-column__quick-actions"},he=["onClick"],ue=x(e.defineComponent({__name:"ExplorerColumn",props:{columnState:{},index:{},isActive:{type:Boolean}},emits:["item-click","item-select","context-menu","refresh","load-more","action","filter-change"],setup(t,{emit:c}){const n=t,o=c,l=e.ref(null),a=e.ref(!1),i=e.computed(()=>n.columnState.config.filters&&n.columnState.config.filters.length>0),k=e.computed(()=>n.columnState.selectedIds.size>0),p=e.computed(()=>{var m;return((m=n.columnState.config.view)==null?void 0:m.loadingRows)||10}),_=e.computed(()=>{var m;return((m=n.columnState.config.view)==null?void 0:m.emptyMessage)||"No items found"}),u=e.computed(()=>n.columnState.isLoading&&n.columnState.items.length===0),B=e.computed(()=>{if(!n.columnState.config.actions)return[];const m=n.columnState.items.filter(s=>n.columnState.selectedIds.has(s.id)),h=m.length;return n.columnState.config.actions.filter(s=>h===1&&s.showOnSingleSelect===!1||h>1&&s.showOnMultipleSelect===!1||h===1&&s.showOnMultipleSelect===!0&&s.showOnSingleSelect===!1||h>1&&s.showOnSingleSelect===!0&&s.showOnMultipleSelect===!1?!1:s.visible?s.visible(m):!0)}),S=()=>{a.value=!a.value},w=(m,h)=>{o("item-click",m,n.index)},M=(m,h)=>{o("item-select",m,n.index,h)},r=(m,h)=>{o("context-menu",m,n.index,h)},f=()=>{o("refresh",n.index)},g=()=>{if(!l.value)return;const{scrollTop:m,scrollHeight:h,clientHeight:s}=l.value;m+s>=h-100&&n.columnState.hasMore&&!n.columnState.isLoading&&o("load-more",n.index)},y=m=>{o("action",m,n.index)},N=(m,h)=>{o("filter-change",m,h,n.index)},ye=m=>({"lucide:trash":d.Trash,"lucide:download":d.Download,"lucide:edit":d.Edit,"lucide:mail":d.Mail})[m]||null;return(m,h)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["explorer-column",{"explorer-column--active":t.isActive}])},[e.createElementVNode("div",J,[e.createElementVNode("h3",Q,e.toDisplayString(t.columnState.config.name),1),e.createElementVNode("div",Z,[i.value?(e.openBlock(),e.createElementBlock("button",{key:0,class:e.normalizeClass(["explorer-column__filter-btn",{active:a.value}]),onClick:S},[e.createVNode(e.unref(d.Filter),{size:16})],2)):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"explorer-column__refresh-btn",onClick:f},[e.createVNode(e.unref(d.RefreshCw),{size:16})])])]),a.value&&i.value?(e.openBlock(),e.createElementBlock("div",K,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.columnState.config.filters,s=>(e.openBlock(),e.createElementBlock("div",{key:s.key,class:"filter-item"},[e.createElementVNode("label",v,e.toDisplayString(s.label),1),s.type==="search"?(e.openBlock(),e.createElementBlock("input",{key:0,type:"text",class:"filter-item__input",placeholder:`Search ${s.label.toLowerCase()}...`,value:t.columnState.filters[s.key]||"",onInput:C=>N(s.key,C.target.value)},null,40,ee)):s.type==="number"?(e.openBlock(),e.createElementBlock("input",{key:1,type:"number",class:"filter-item__input",placeholder:s.label,value:t.columnState.filters[s.key]||"",onInput:C=>N(s.key,C.target.value)},null,40,te)):s.type==="select"?(e.openBlock(),e.createElementBlock("select",{key:2,class:"filter-item__select",value:t.columnState.filters[s.key]||"",onChange:C=>N(s.key,C.target.value)},[h[0]||(h[0]=e.createElementVNode("option",{value:""},"All",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.options,C=>(e.openBlock(),e.createElementBlock("option",{key:C.value,value:C.value},e.toDisplayString(C.label),9,oe))),128))],40,ne)):e.createCommentVNode("",!0)]))),128))])):e.createCommentVNode("",!0),e.createElementVNode("div",{ref_key:"scrollContainer",ref:l,class:"explorer-column__content",onScroll:g},[u.value?(e.openBlock(),e.createElementBlock("div",le,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(p.value,s=>(e.openBlock(),e.createElementBlock("div",{key:s,class:"skeleton-item"},[...h[1]||(h[1]=[e.createStaticVNode('<div class="skeleton-item__icon" data-v-b8fd4b62></div><div class="skeleton-item__content" data-v-b8fd4b62><div class="skeleton-item__name" data-v-b8fd4b62></div><div class="skeleton-item__metadata" data-v-b8fd4b62></div></div><div class="skeleton-item__chevron" data-v-b8fd4b62></div>',3)])]))),128))])):t.columnState.error?(e.openBlock(),e.createElementBlock("div",ce,[h[2]||(h[2]=e.createElementVNode("p",null,"Error loading data",-1)),e.createElementVNode("button",{onClick:f},"Retry")])):t.columnState.items.length===0&&!t.columnState.isLoading?(e.openBlock(),e.createElementBlock("div",se,e.toDisplayString(_.value),1)):t.columnState.items.length>0?(e.openBlock(),e.createElementBlock("div",ae,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.columnState.items,s=>{var C,D,L;return e.openBlock(),e.createBlock(Y,{key:s.id,item:s,selected:t.columnState.selectedIds.has(s.id),selectable:((C=t.columnState.config.selection)==null?void 0:C.multiple)??!1,clickable:!0,"show-icon":((D=t.columnState.config.view)==null?void 0:D.showIcon)??!0,"show-metadata":((L=t.columnState.config.view)==null?void 0:L.showMetadata)??!0,onClick:(E,I)=>w(E),onSelect:(E,I)=>M(E,I),onContextmenu:(E,I)=>r(E,I)},null,8,["item","selected","selectable","show-icon","show-metadata","onClick","onSelect","onContextmenu"])}),128)),t.columnState.isLoading&&t.columnState.items.length>0?(e.openBlock(),e.createElementBlock("div",ie," Loading more... ")):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0)],544),k.value?(e.openBlock(),e.createElementBlock("div",re,[e.createElementVNode("div",me,e.toDisplayString(t.columnState.selectedIds.size)+" selected ",1),e.createElementVNode("div",de,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(B.value,s=>(e.openBlock(),e.createElementBlock("button",{key:s.key,class:e.normalizeClass(["action-btn",`action-btn--${s.color||"default"}`]),onClick:C=>y(s.key)},[s.icon?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(ye(s.icon)),{key:0,size:14})):e.createCommentVNode("",!0),e.createTextVNode(" "+e.toDisplayString(s.label),1)],10,he))),128))])])):e.createCommentVNode("",!0)],2))}}),[["__scopeId","data-v-b8fd4b62"]]),ke=["onClick"],fe=x(e.defineComponent({__name:"ExplorerContextMenu",props:{visible:{type:Boolean},x:{},y:{},actions:{}},emits:["close","action"],setup(t,{emit:c}){const n=t,o=c,l=()=>{o("close")},a=p=>{o("action",p.key),o("close")},i=p=>({"lucide:download":d.Download,"lucide:trash":d.Trash,"lucide:edit":d.Edit,"lucide:eye":d.Eye})[p]||null,k=()=>{n.visible&&o("close")};return e.onMounted(()=>{document.addEventListener("click",k)}),e.onUnmounted(()=>{document.removeEventListener("click",k)}),(p,_)=>(e.openBlock(),e.createBlock(e.Teleport,{to:"body"},[t.visible?(e.openBlock(),e.createElementBlock("div",{key:0,class:"context-menu",style:e.normalizeStyle({top:`${t.y}px`,left:`${t.x}px`}),onClick:l},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.actions,u=>(e.openBlock(),e.createElementBlock("div",{key:u.key,class:"context-menu__item",onClick:B=>a(u)},[u.icon?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(i(u.icon)),{key:0,size:16})):e.createCommentVNode("",!0),e.createElementVNode("span",null,e.toDisplayString(u.label),1)],8,ke))),128))],4)):e.createCommentVNode("",!0)]))}}),[["__scopeId","data-v-569d2f59"]]),pe={class:"explorer-container"},ge={class:"explorer-viewport"},$=x(e.defineComponent({__name:"ExplorerContainer",props:{rootColumn:{}},setup(t,{expose:c}){const n=t,o=F(),l=e.reactive({visible:!1,x:0,y:0,actions:[],targetItem:null,targetColumnIndex:-1});n.rootColumn&&o.openColumn(n.rootColumn,0);const a=async(r,f)=>{o.selectItem(f,r.id,!1);const g=o.columns.get(f);g!=null&&g.config.itemClick&&await o.navigateToItem(r,f)},i=(r,f,g)=>{o.selectItem(f,r.id,g)},k=(r,f,g)=>{const y=o.columns.get(f);!(y!=null&&y.config.actions)||y.config.actions.length===0||(y.selectedIds.has(r.id)||o.selectItem(f,r.id,!1),l.visible=!0,l.x=g.clientX,l.y=g.clientY,l.actions=y.config.actions,l.targetItem=r,l.targetColumnIndex=f)},p=()=>{l.visible=!1},_=async r=>{l.targetColumnIndex>=0&&await o.executeAction(l.targetColumnIndex,r)},u=r=>{o.navigateToBreadcrumb(r)},B=async r=>{await o.refreshColumn(r)},S=async r=>{await o.loadNextPage(r)},w=async(r,f)=>{await o.executeAction(f,r)},M=(r,f,g)=>{o.setFilter(g,r,f)};return c({store:o,openColumn:r=>o.openColumn(r),refresh:()=>o.refreshColumn(o.activeColumnIndex)}),(r,f)=>(e.openBlock(),e.createElementBlock("div",pe,[e.unref(o).breadcrumb.length>0?(e.openBlock(),e.createBlock(O,{key:0,breadcrumb:e.unref(o).breadcrumb,onNavigate:u},null,8,["breadcrumb"])):e.createCommentVNode("",!0),e.createElementVNode("div",ge,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o).visibleColumns,(g,y)=>(e.openBlock(),e.createBlock(ue,{key:y,"column-state":g,index:y,"is-active":y===e.unref(o).activeColumnIndex,onItemClick:a,onItemSelect:i,onContextMenu:k,onRefresh:B,onLoadMore:S,onAction:w,onFilterChange:M},null,8,["column-state","index","is-active"]))),128))]),e.createVNode(fe,{visible:l.visible,x:l.x,y:l.y,actions:l.actions,onClose:p,onAction:_},null,8,["visible","x","y","actions"])]))}}),[["__scopeId","data-v-4e9a0e53"]]);function Ce(t){var c,n,o;return{id:t.id,name:t.name,dataProvider:{fetch:async l=>{const a=await t.fetchData(l);return{items:Array.isArray(a)?a:[],hasMore:!1}}},selection:{enabled:t.allowMultipleSelection!==void 0||!!(t.singleActions&&t.singleActions.length>0)||!!(t.multipleActions&&t.multipleActions.length>0),multiple:t.allowMultipleSelection!==void 0?t.allowMultipleSelection:!1},filters:(c=t.filters)==null?void 0:c.map(l=>({...l,default:void 0})),actions:[...((n=t.singleActions)==null?void 0:n.map(l=>({key:l.key,label:l.label,icon:l.icon,color:l.color,showOnSingleSelect:!0,showOnMultipleSelect:!1,handler:async(a,i)=>{await l.handler(a)}})))||[],...((o=t.multipleActions)==null?void 0:o.map(l=>({key:l.key,label:l.label,icon:l.icon,color:l.color,showOnSingleSelect:!1,showOnMultipleSelect:!0,handler:async(a,i)=>{await l.handler(a)}})))||[]],itemClick:t.onItemClick?{type:"navigate",handler:async(l,a)=>{const i=t.onItemClick(l,a);return i?{column:i}:{}}}:void 0,view:{showIcon:!0,showMetadata:!0,emptyMessage:`No ${t.name.toLowerCase()} found`}}}const be={install(t){t.component("ExplorerContainer",$)}};b.ExplorerContainer=$,b.createColumn=Ce,b.default=be,b.useExplorerStore=F,Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
